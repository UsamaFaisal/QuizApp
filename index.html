<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Quiz App</title>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   </head>
   <body>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
      <div class="container mt-5" id="question">
         <h1 class="mb-4">Quiz App</h1>
         <div class="form-group">
            <label>Question</label>
            <input type="text" class="form-control" id="questionInput" placeholder="Enter Question">
         </div>
         <div class="form-group mb-3">
            <label for="optionsSelect">Number of Options</label>
            <select class="form-control" id="optionsSelect" onchange="generateOptionsInputs()">
               <option value="0" selected>-Select-</option>
               <option value="2">2</option>
               <option value="3">3</option>
               <option value="4">4</option>
               <option value="5">5</option>
            </select>
         </div>
         <div id="optionsContainer"></div>
         <button class="btn btn-primary mt-3" onclick="addQuestion()">Add Question</button>
      </div>
      <div class="container mt-5" id="quiz">
         <button class="btn btn-primary" onclick="startQuiz()" id="start">Start Quiz</button>
         <div id="quizContainer" class="mt-4" style="display: none;">
            <div id="quizquestionContainer" class="mb-3"></div>
            <div id="quizoptionsContainer"></div>
            <button class="btn btn-primary mt-3" onclick="nextQuestion()">Next</button>
            <p id="timer" class="mt-3"></p>
         </div>
         <p id="score" class="mt-4" style="display: none;">Total Score: <span id="totalScore">0</span></p>
         <button id="mainmenu" style="display: none;" onclick="mainmenu()" class="mt-3">Go to Main Menu</button>
         <button id="restart" style="display: none;" onclick="startQuiz()" class="mt-3">Restart</button>
      </div>
      <script>
         function mainmenu(){
             $('#score').hide();
             $('#mainmenu').hide();
             $('#restart').hide();
             $('#question').show();
             $('#start').show();
         }
         function generateOptionsInputs() {
             var optionsSelect = $('#optionsSelect');
             var optionsContainer = $('#optionsContainer');
             var numOptions = parseInt(optionsSelect.val());
             optionsContainer.empty();
             // options add
             for (var i = 1; i <= numOptions; i++) {
                 var optionListItem = $('<li>').attr({
                     class: 'mb-2',
                 });
                 var optionInput = $('<input>').attr({
                     type: 'text',
                     
                     placeholder: 'Enter Option ' + i
                 });
                 optionListItem.append(optionInput);
                 optionsContainer.append(optionListItem);
             }
             var answerfield=$('<input>').attr({
                     type: 'text',
                     placeholder: 'Enter Correct Answer '
                 });;
                 optionsContainer.append(answerfield);
         
         }
         function addQuestion() {
             var questionInput = $('#questionInput');
             if(questionInput.val()==="")
             {
                 alert("Please Enter a valid Question.");
                 return;
             }
             var optionsSelect = $('#optionsSelect');
             var numOptions = parseInt(optionsSelect.val());
             // console.log(numOptions);
             if(numOptions===0)
             {
                 alert("Please Input Valid Number of Options.");
                 return;
             } 
             var optionsContainer = $('#optionsContainer');
             console.log(optionsContainer)
             var questionInputValue = $('#questionInput').val().trim();
             if (questionInputValue !== '') {
                 var options = $('#optionsContainer input').map(function() {
                     return $(this).val().trim();
                 }).get();
                 
                 var answerIndex = options.length - 1;
                 var optionsWithoutAnswer = options.slice(0, answerIndex);
                 var answer = options[answerIndex];
                 // duplicate options
                 if (optionsWithoutAnswer.length !== new Set(optionsWithoutAnswer).size) {
                     alert("Duplicate values found in options.");
                     return;
                 }
         
                 // answer in options
                 if (optionsWithoutAnswer.indexOf(answer) === -1) {
                     alert("Answer must be in the options.");
                     return;
                 }
                 if (options.some(option => option === '')) {
                     alert("Please fill all the Options and Answer Field.");
                 }
                 else {       
                     // Clear
                     $('#questionInput').val('');
                     $('#optionsContainer').empty();
                     $('#optionsSelect').val('0')
                     $('#optionContainer').empty()
                     var storedQuestions = JSON.parse(localStorage.getItem('quizQuestions')) || [];
                     storedQuestions.push({
                         question: questionInputValue,
                         options: options
                     });
                     localStorage.setItem('quizQuestions', JSON.stringify(storedQuestions));
                     alert('Question Added Succesfully!')
                 }
             } 
             else {
                 alert("Please Enter a valid Question.");
             }
         }
         var quizQuestions = JSON.parse(localStorage.getItem('quizQuestions')) || [];
         var currentQuestionIndex = 0;
         var totalScore = 0;
         var timer;
         function resetTimer() {
             clearInterval(timer);
             startTimer();
         }
         function nextQuestion() {
             currentQuestionIndex++;
             if (currentQuestionIndex < quizQuestions.length) {
                 showQuestion();
                 resetTimer();
             } else {
                 endQuiz();
             }
         }
         function startTimer() {
             var timeLeft = 15;
             timer = setInterval(function () {
                 $('#timer').text('Time remaining: ' + timeLeft + 's');
                 if (timeLeft === 0) {
                     nextQuestion();
                 }
                 timeLeft--;
             }, 1000);
         }
         function startQuiz() {
             $('#restart').css('display','none');
             $('#mainmenu').css('display','none');
             $('#question').css('display','none');
             $('#start').css('display','none');
             showQuestion();
             $('#quizContainer').css('display','block');
             $('#score').css('display','none');
             $('#timer').text('Time remaining: 15s');
             startTimer();
         }
         function checkAnswer(option) {
             console.log(option)
             var options = quizQuestions[currentQuestionIndex].options;
             var correctAnswer = options[options.length - 1];
             console.log(correctAnswer)
             if (option.toLowerCase() === correctAnswer.toLowerCase()) 
             {
                 totalScore+=5;
             }
             nextQuestion();
         }
         function showQuestion() {
             var quizquestionContainer = $('#quizquestionContainer');
             var quizoptionsContainer = $('#quizoptionsContainer');
         
             quizquestionContainer.text('Question: ' + quizQuestions[currentQuestionIndex].question);
         
             quizoptionsContainer.empty();
             quizQuestions[currentQuestionIndex].options.slice(0,-1).forEach(function (option, index) {
                 var optionButton = $('<button>');
                 optionButton.text(option);
                 optionButton.click( function () {
                     checkAnswer(option);
                 });
                 quizoptionsContainer.append(optionButton);
             });
         }
         
         function endQuiz() {
             clearInterval(timer);
             $('#quizContainer').css('display', 'none');
             $('#score').css('display', 'block');
             $('#mainmenu').css('display', 'block');
             $('#restart').css('display', 'block');
             $('#totalScore').text(totalScore);
             currentQuestionIndex = 0;
             totalScore = 0;
         }
         
      </script>
   </body>
</html>